<div data-ng-include="'app/templates/header_latest.html'"></div>
<section id="main-content">
    <section class="wrapper site-min-height">
        <div class="container-fluid">
            <div class="mat-form row row-centered">
                <div class="mat-form col-md-12">
                    <div class="mat-form card">
                        <div class="card-header card-header-primary listPagePrimaryCardHeader">
                            <h4 class="card-title">{{title}} {{(product ? " - " + product.name : "")}}</h4>
                            <div class="filterButtons">
                                <span class="filterButtonIcons" >
                                    <span class="dropdown-toggle" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-v"></i>
                                    </span>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" id="btnAddUser" data-ng-show="isAddPriceGroupAllowed()" data-ng-click="showAddPriceGroupForm()"><i class="fa fa-plus"></i>&nbsp; Add Price Group</a>
                                    </div>
                                </span> 
                                <div class="filterInputInHeaderWrapper filterInputForDesktop">
                                    <input type="text" class="filterInputInHeaderElement" placeholder="Search" data-ng-model="searchText">
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row p-0 m-0">
                                <div class="col-12 col-md-8">
                                    <div class="filterInputInHeaderWrapper filterInputForMobile filterInputInHeaderWrapperSearch" >
                                        <input type="text" class="filterInputInHeaderElement" placeholder="Search" data-ng-model="searchText">
                                </div>
                            </div>
                            <div class="col-12 listPageTableForMobile">
                                <div class="listPageTableForMobileHeader">
                                    <div class="listPageTableForMobileRow">
                                        <div class="listPageTableForMobileRow1">
                                            <div class="mobileTableEachColumn mobileTablePrimary">
                                                <div class="mobilePrimaryFirstRow">
                                                    <p data-ng-click="setPriceGroupSortParameters('name');getPriceGrouplist()">Name</p>
                                                    <p data-ng-click="setPriceGroupSortParameters('description');getPriceGrouplist()">Description</p>
                                                </div>
                                                <div class="mobilePrimarySecondRow">
                                                    <p data-ng-click="setPriceGroupSortParameters('uom_name');getPriceGrouplist()">Unit of Measure</p>
                                                    <p data-ng-click="setPriceGroupSortParameters('price');getPriceGrouplist()">Default Price</p>
                                                </div>
                                            </div>
                                            <div class="mobileTableEachColumn mobileTableButtons" style="margin-top: 15px;">
                                                <div class="mobileTableButtonWrapper">
                                                    <span class="mobileTableButton">
                                                        <a  data-ng-if="!expandAll" data-ng-click="expandAllPricegroups()"><i class="fas fa-angle-double-down"></i></a>
                                                        <a  data-ng-if="expandAll" data-ng-click="collapseAllPricegroups()"><i class="fas fa-angle-double-up "></i></a> 
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="listPageTableForMobileRow" data-ng-repeat="x in pricegrouplist | filter:searchText">
                                        <div class="listPageTableForMobileRow1">

                                            <div class="mobileTableEachColumn mobileTablePrimary">
                                                <div class="mobilePrimaryFirstRow">
                                                    <p><span class="text-decoration-underline-mobile" data-ng-click="showEditPriceGroupForm(x.id);$event.stopPropagation();">{{x.name}}</span></p>
                                                    <p>{{x.description}}</p>
                                                </div>
                                                <div class="mobilePrimarySecondRow">
                                                    <p>{{x.uom_name}}</p>
                                                    <p>{{x.unit_price}}</p>
                                                </div>
                                            </div>
                                            <div class="mobileTableEachColumn mobileTableButtons">
                                                <div class="mobileTableButtonWrapper">
                                                    <span class="mobileTableButton">
                                                        <span class="dropdown-toggle" id="navbarDropdown_{{$index}}" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                            <i class="fa fa-ellipsis-h"></i>
                                                        </span>
                                                        <div class="dropdown-menu" aria-labelledby="navbarDropdown_{{$index}}">
                                                            <a id="btnEdit{{$index}}" class="dropdown-item listPageActionGreen" data-ng-show="isEditPriceGroupAllowed()" data-ng-click="showEditPriceGroupForm(x.id);$event.stopPropagation();"><i class="fas fa-edit"></i> Edit Price Group</a> 
                                                            <a id="btnd{{$index}}" class="dropdown-item listPageActionIconsRed" data-ng-show="isDeletePriceGroupAllowed()" data-ng-click="deletePriceGroup(x);$event.stopPropagation();"><i class="fas fa-trash"></i> Delete Price Group</span>
                                                            <a id="btn{{$index}}" class="dropdown-item listPageActionIconsBlue" data-ng-show="isStockSummaryVisible()" data-ng-click="showStockSummaryByPriceGroup(x.id);$event.stopPropagation();"><i class="fas fa-eye"></i> Show Stock Summary</a>
                                                        </div>
                                                    </span>
                                                    <span class="mobileTableButton" data-ng-show="(x.expanded == undefined || !x.expanded)" data-ng-click="expand(x);$event.stopPropagation();"> <i class="fa fa-angle-down" /></span>
                                                    <span class="mobileTableButton" data-ng-show="x.expanded" ng-click="expand(x);$event.stopPropagation();"><i class="fa fa-angle-up" /></span>    
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card" data-ng-show="x.expanded" style="border: 1px solid grey;">
                                            <h5 class="card-header childcardheader">Edit Price Groups Details</h5>       
                                            <form class="cmxform form-horizontal tasi-form" id="signupForm" method="post" name="myform">
                                                <div class="row">
                                                    <div class="col-lg-12 eachCardWrapperDiv">
                                                        <!-- <div class="card MB0"> -->         
                                                            <div class="card-body">
                                                               <div class="row">
                                                                   <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                      <div class="form-group bmd-form-group floating-input-container">
                                                                        <input class="floating-input"  type="text" name="name" id="name" data-ng-model="x.new_pricegroup.name" required="true" placeholder="Enter Name" style="text-transform: capitalize;" data-ng-class="((myform.name.$dirty || submitted) && myform.name.$invalid) || ((myform.name.$dirty || submitted) && myform.name.$error.required) ? 'error' : 'success'"/>
                                                                        <label class="input-label" for="name">
                                                                           Name
                                                                        </label>
                                                                        <span class="help-block errorText" ng-show="((myform.name.$dirty || submitted) && myform.name.$invalid) || ((myform.name.$dirty || submitted) && myform.name.$error.required)">Please enter name</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                    <div class="form-group bmd-form-group floating-input-container">
                                                                        <input class="floating-input" type="text" name="description" id="description" data-ng-model="x.new_pricegroup.description" required="true" placeholder="Enter description" data-ng-class="((myform.description.$dirty || submitted) && myform.description.$invalid) || ((myform.description.$dirty || submitted) && myform.description.$error.required) ? 'error' : 'success'"/>
                                                                        <label class="input-label" for="description">
                                                                            Description
                                                                        </label>
                                                                        <span class="help-block errorText" ng-show="((myform.description.$dirty || submitted) && myform.description.$invalid) || ((myform.description.$dirty || submitted) && myform.description.$error.required)">Please enter description</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                    <div class="floating-cotainer-with-refresh">
                                                                        <div class="form-group bmd-form-group floating-input-container">
                                                                            <select id="uom_id" name="uom_id" data-ng-model="x.new_pricegroup.uom_id" required ng-options="x.id as x.name  for x in uomlist" placeholder="">
                                                                            </select>
                                                                            <label class="select-label" for="uom_id">
                                                                                Unit
                                                                            </label>
                                                                            <span class="help-block errorText" ng-show="((myform.uom_id.$dirty || submitted) && myform.uom_id.$invalid) || ((myform.uom_id.$dirty || submitted) && myform.uom_id.$error.required)">Please select unit</span>
                                                                        </div>
                                                                        <div class = "floatContainerRefreshDiv" >
                                                                            <span class ="refreshButton" type="button" data-ng-click ="getUnitOfMeasureslist()"><i class="fas fa-sync"></i> </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" data-ng-if="false">
                                                                    <div class="form-group" data-ng-show="!editmode">
                                                                        <label class="col-lg-2 control-label" style="font-weight: bold">Multi Unit?</label>
                                                                        <input type="checkbox" name="chk_multi_unit" id="chk_multi_unit" data-ng-model="multi_unit"/>
                                                                    </div>
                                                                     <div class="form-group" data-ng-if="( (multi_unit && !editmode) || (editmode && pricegroup.uomconversionlist.length > 0))">
                                                                        <label class="col-sm-2 control-label">UOM Conversion </label>
                                                                        <button id="btnAddUOM" data-ng-click="addUOMConversionToPriceGroup();">(+)</button>
                                                                        <br/><br/><br/>
                                                                        <table  class="table table-striped table-hover adv-table editable-table " id="editable-sample">
                                                                            <thead>
                                                                            <tr>
                                                                            <th>QTY</th>
                                                                            <th>UOM</th>
                                                                            <th> = </th>
                                                                            <th>QTY</th>
                                                                            <th>UOM</th>
                                                                            <th>Del</th>
                                                                            </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr data-ng-repeat="y in pricegroup.uomconversionlist">
                                                                                <td><input class="form-control" type="numeric" data-ng-model="y.from_qty" id="to_qty{{$index}}" required="true"/></td>
                                                                                <td>
                                                                                    <select class="form-control" id="from_uom_id{{$index}}" name="from_uom_id{{$index}}" data-ng-model="y.from_uom.id" required data-ng-options="x.id as x.name for x in uomlist">
                                                                                    </select>
                                                                                </td>
                                                                                <td> = </td>
                                                                                <td><input class="form-control" type="numeric" data-ng-model="y.to_qty" id="to_qty{{$index}}" required="true"/></td>
                                                                                <td>
                                                                                    <select class="form-control" id="to_uom_id{{$index}}" name="to_uom_id{{$index}}" data-ng-model="y.to_uom.id" required data-ng-options="x.id as x.name for x in uomlist">
                                                                                    </select>
                                                                                </td>
                                                                                <td><button id="delbtn{{$index}}" class="btn btn-danger" data-ng-show="!editmode" data-ng-click="removeUOMConversionFromArray($index)">Del</button></td>
                                                                            </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div> 
                                                                </div>                   
                                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                                    <div class="form-group bmd-form-group floating-input-container">
                                                                        <table class="table table-striped table-hover ">
                                                                            <thead>
                                                                            <th>Category</th>
                                                                            <th>Price</th>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr data-ng-repeat="y in x.new_pricegroup.pricelistlist">
                                                                                <td>{{y.customer_type_name}}</td>
                                                                                <td>
                                                                                    <input class="floating-input" type="number" name="price{{$index}}" id="price" data-ng-model="y.unit_price" required="true" placeholder="Enter Price."/>
                                                                                    <span data-ng-show="((myform.price{{$index}}.$dirty || submitted) && myform.price{{$index}}.$invalid) || ((myform.price{{$index}}.$dirty || submitted) && myform.price{{$index}}.$error.required)" style="color:red">Please enter Price</span>
                                                                                </td>
                                                                            </tr>             
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                           </div>
                                                        <!-- </div> -->
                                                      </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                  <div class="row-centered">
                                                      <button class="btn primarySubmitButton mobileSubmitButton" type="button" data-ng-click='submitted=true;!myform.$invalid && savePriceGroup(x.new_pricegroup); newdata(x.new_pricegroup);'>Save Price Group</button>
                                                      <span>{{message}}</span>
                                                  </div>
                                                </div>
                                            </form>                                            
                                        </div>                                        
                                    </div> 
                                </div> 
                            </div>
                            <div class="col-12 listPageFiltersWrapperDiv">                             
                                <div class="listTableDiv">
                                    <div class="adv-table editable-table">
                                        <div class="space15"></div>
                                        <table  class="table table-striped " id="editable-sample">
                                            <thead>
                                            <tr>
                                                <th class="sortable-header" data-ng-click="setPriceGroupSortParameters('name');getPriceGrouplist()">NAME
                                                    <span class="sort-icons" ng-class="getIcon('name')"/>
                                                <th class="sortable-header"  data-ng-click="setPriceGroupSortParameters('description');getPriceGrouplist()">DESCRIPTION
                                                    <span class="sort-icons" ng-class="getIcon('description')"/>
                                                </th>
                                                <th class="sortable-header" data-ng-click="setPriceGroupSortParameters('uom_name');getPriceGrouplist()">UNIT OF MEASURE
                                                    <span class="sort-icons" ng-class="getIcon('uom_name')"/>
                                                </th>
                                                <th style="text-align:right" class="sortable-header" data-ng-click="setPriceGroupSortParameters('price');getPriceGrouplist()">DEFAULT PRICE
                                                    <span class="sort-icons" ng-class="getIcon('price')"/>
                                                </th>
                                                <th>ACTIONS
                                                <span> 
                                                    <a data-ng-if="!expandAll" data-ng-click="expandAllPricegroups()"><i style="color: whitesmoke; margin-left: 46px;" class="fas fa-angle-double-down"></i></a>
                                                    <a data-ng-if="expandAll" data-ng-click="collapseAllPricegroups()"><i style="color: whitesmoke; margin-left: 46px;" class="fas fa-angle-double-up"></i></a> 
                                                </span>
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr data-ng-repeat-start="x in pricegrouplist | filter:searchText" xclass="active">
                                                <td>
                                                    <a data-ng-click="priceGroupRowClick(x.id);$event.stopPropagation();" data-ng-show="isEditPriceGroupAllowed">{{x.name}}</a><span data-ng-hide="isEditPriceGroupAllowed">{{x.name}}</span>
                                                </td>
                                                <td>{{x.description}}</td>
                                                <td>{{x.uom_name}}</td>
                                                <td align="right">{{x.unit_price}}</td>
                                                <td>
                                                    <span id="btnEdit{{$index}}" class="listPageActionIcons listPageActionGreen" data-ng-show="isEditPriceGroupAllowed()" data-ng-click="showEditPriceGroupForm(x.id);$event.stopPropagation();"><i class="fas fa-edit"></i></span> 
                                                    <span id="btnd{{$index}}" class="listPageActionIcons listPageActionIconsRed" data-ng-show="isDeletePriceGroupAllowed()" data-ng-click="deletePriceGroup(x);$event.stopPropagation();"><i class="fas fa-trash"></i></span>
                                                    <span id="btn{{$index}}" class="listPageActionIcons listPageActionIconsBlue" data-ng-show="isStockSummaryVisible()" data-ng-click="showStockSummaryByPriceGroup(x.id);$event.stopPropagation();">Stock</span>
                                                    <span style="background-color: Brown" class="listPageActionIcons" data-ng-show="(x.expanded == undefined || !x.expanded)" ng-click="expand(x);$event.stopPropagation();"><i class="fa fa-angle-down" /></span>
                                                    <span style="background-color:gold" class="listPageActionIcons" data-ng-show="x.expanded" ng-click="expand(x);$event.stopPropagation();"><i class="fa fa-angle-up" /></span>
                                                </td>
                                            </tr>
                                           <tr data-ng-repeat-end data-ng-show="x.expanded">
                                               <td colspan ="5">
                                                    <div class="card-body">
                                                            <form class="cmxform form-horizontal tasi-form" id="signupForm" method="post" name="myform">
                                                                <div class="row">
                                                                    <div class="col-lg-12 eachCardWrapperDiv">
                                                                        <div class="card MB0">
                                                                            <h5 class="card-header childcardheader">Edit Price Groups Details</h5>
                                                                            <div class="card-body">
                                                                               <div class="row">
                                                                                   <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                                      <div class="form-group bmd-form-group floating-input-container">
                                                                                        <input class="floating-input"  type="text" name="name" id="name" data-ng-model="x.new_pricegroup.name" required="true" placeholder="Enter Name" style="text-transform: capitalize;" data-ng-class="((myform.name.$dirty || submitted) && myform.name.$invalid) || ((myform.name.$dirty || submitted) && myform.name.$error.required) ? 'error' : 'success'"/>
                                                                                        <label class="input-label" for="name">
                                                                                           Name
                                                                                        </label>
                                                                                        <span class="help-block errorText" ng-show="((myform.name.$dirty || submitted) && myform.name.$invalid) || ((myform.name.$dirty || submitted) && myform.name.$error.required)">Please enter name</span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                                    <div class="form-group bmd-form-group floating-input-container">
                                                                                        <input class="floating-input" type="text" name="description" id="description" data-ng-model="x.new_pricegroup.description" required="true" placeholder="Enter description" data-ng-class="((myform.description.$dirty || submitted) && myform.description.$invalid) || ((myform.description.$dirty || submitted) && myform.description.$error.required) ? 'error' : 'success'"/>
                                                                                        <label class="input-label" for="description">
                                                                                            Description
                                                                                        </label>
                                                                                        <span class="help-block errorText" ng-show="((myform.description.$dirty || submitted) && myform.description.$invalid) || ((myform.description.$dirty || submitted) && myform.description.$error.required)">Please enter description</span>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
                                                                                    <div class="floating-cotainer-with-refresh">
                                                                                        <div class="form-group bmd-form-group floating-input-container">
                                                                                            <select id="uom_id" name="uom_id" data-ng-model="x.new_pricegroup.uom_id" required ng-options="x.id as x.name  for x in uomlist" placeholder="">
                                                                                            </select>
                                                                                            <label class="select-label" for="uom_id">
                                                                                                Unit
                                                                                            </label>
                                                                                            <span class="help-block errorText" ng-show="((myform.uom_id.$dirty || submitted) && myform.uom_id.$invalid) || ((myform.uom_id.$dirty || submitted) && myform.uom_id.$error.required)">Please select unit</span>
                                                                                        </div>
                                                                                        <div class = "floatContainerRefreshDiv" >
                                                                                            <span class ="refreshButton" type="button" data-ng-click ="getUnitOfMeasureslist()"><i class="fas fa-sync"></i> </span>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" data-ng-if="false">
                                                                                    <div class="form-group" data-ng-show="!editmode">
                                                                                        <label class="col-lg-2 control-label" style="font-weight: bold">Multi Unit?</label>
                                                                                        <input type="checkbox" name="chk_multi_unit" id="chk_multi_unit" data-ng-model="multi_unit"/>
                                                                                    </div>
                                                                                     <div class="form-group" data-ng-if="( (multi_unit && !editmode) || (editmode && pricegroup.uomconversionlist.length > 0))">
                                                                                        <label class="col-sm-2 control-label">UOM Conversion </label>
                                                                                        <button id="btnAddUOM" data-ng-click="addUOMConversionToPriceGroup();">(+)</button>
                                                                                        <br/><br/><br/>
                                                                                        <table  class="table table-striped table-hover adv-table editable-table " id="editable-sample">
                                                                                            <thead>
                                                                                            <tr>
                                                                                            <th>QTY</th>
                                                                                            <th>UOM</th>
                                                                                            <th> = </th>
                                                                                            <th>QTY</th>
                                                                                            <th>UOM</th>
                                                                                            <th>Del</th>
                                                                                            </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            <tr data-ng-repeat="y in pricegroup.uomconversionlist">
                                                                                                <td><input class="form-control" type="numeric" data-ng-model="y.from_qty" id="to_qty{{$index}}" required="true"/></td>
                                                                                                <td>
                                                                                                    <select class="form-control" id="from_uom_id{{$index}}" name="from_uom_id{{$index}}" data-ng-model="y.from_uom.id" required data-ng-options="x.id as x.name for x in uomlist">
                                                                                                    </select>
                                                                                                </td>
                                                                                                <td> = </td>
                                                                                                <td><input class="form-control" type="numeric" data-ng-model="y.to_qty" id="to_qty{{$index}}" required="true"/></td>
                                                                                                <td>
                                                                                                    <select class="form-control" id="to_uom_id{{$index}}" name="to_uom_id{{$index}}" data-ng-model="y.to_uom.id" required data-ng-options="x.id as x.name for x in uomlist">
                                                                                                    </select>
                                                                                                </td>
                                                                                                <td><button id="delbtn{{$index}}" class="btn btn-danger" data-ng-show="!editmode" data-ng-click="removeUOMConversionFromArray($index)">Del</button></td>
                                                                                            </tr>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div> 
                                                                                </div>  
                                                                                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                                                    <div class="form-group bmd-form-group floating-input-container">
                                                                                        <table class="table table-striped table-hover ">
                                                                                            <thead>
                                                                                            <th>Category</th>
                                                                                            <th>Price</th>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                            <tr data-ng-repeat="y in x.new_pricegroup.pricelistlist">
                                                                                                <td>{{y.customer_type_name}}</td>
                                                                                                <td>
                                                                                                    <input class="floating-input" type="number" name="price{{$index}}" id="price" data-ng-model="y.unit_price" required="true" placeholder="Enter Price."/>
                                                                                                    <span data-ng-show="((myform.price{{$index}}.$dirty || submitted) && myform.price{{$index}}.$invalid) || ((myform.price{{$index}}.$dirty || submitted) && myform.price{{$index}}.$error.required)" style="color:red">Please enter Price</span>
                                                                                                </td>
                                                                                            </tr>
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                </div>
                                                                           </div>
                                                                        </div>
                                                                      </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                  <div class="row-centered">
                                                                      <button class="btn primarySubmitButton mobileSubmitButton" type="button" data-ng-click='submitted=true;!myform.$invalid && savePriceGroup(x.new_pricegroup); newdata(x.new_pricegroup);'>Save Price Group</button>
                                                                      <span>{{message}}</span>
                                                                  </div>
                                                                </div>
                                                            </form>
                                                    </div>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>                          
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>
